<ng-dnd-preview [allBackends]="true">
  <ng-template let-type let-item="item">
    <ng-container [ngSwitch]="type">
      <kanban-card *ngSwitchCase="ItemTypes.CARD" [card]="item.data" [preview]="true"
                   [ngStyle]="item.size.style()">
      </kanban-card>
      <kanban-list *ngSwitchCase="ItemTypes.LIST" [list]="item.data" [preview]="true"
                   [ngStyle]="item.size.style()">
      </kanban-list>
    </ng-container>
  </ng-template>
</ng-dnd-preview>

<!--
    This is the 'sugared' version.
    Use ng-dnd-sortable-list, and give it a template for how to
    render each element. It will handle creating the `*ngFor`
    for you, from the list the spec provides, and will help
    you pass context down to [ngDndSortableRender].
--->

<ng-dnd-sortable-list class="kanban-root"
                      [listId]="888"
                      [children]="specs.tree"
                      [spec]="specs.boardSpec"
                      hoverTrigger="fixed"
                      [horizontal]="true">
  <!-- 'horizontal' makes the hover behave differently. You need CSS to complete the job.
        .kanban-root must still be like a block element, so no collapsing float containers.
        Flexbox/CSS Grid are great. -->

  <!-- The ng-dnd-sortable-list component stamps out one ngDndSortableTemplate
       for each item in yourSpec.getList(). -->
  <ng-template ngDndSortableTemplate let-context>
    <!-- context is everything the ngDndSortableRender needs to do its job.
         It includes 'data' and 'index', which are just from an *ngFor of your spec's getList(). -->
    <kanban-list [ngDndSortableRender]="context"
                 [list]="context.data"
                 (addCard)="addCard(context.data.id, $event)">

      <!-- is this kanban-list draggable? NOT YET.

          -   because ngDndSortableRender doesn't know which DOM element should be
              draggable (maybe you want a drag handle), it lets us decide by
              giving us `render.source`, a DragSource object that is already
              configured. You are responsible for connecting it to the DOM.
              If you weren't using child components, you might just do:

              <div class="each-child"
                  [ngDndSortableRender]="context"
                  #render="ngDndSortableRender"
                  [dragSource]="render.source"></div>

          -   you can either get the directive using `#render="ngDndSortableRender"`,
              or inject SkyhookSortableRenderer<KanbanList> into KanbanListComponent.

          -   we did the latter here, because we want a 'drag handle' inside kanban-list.
              the other way is demonstrated with the list of cards inside kanban-list.
      -->

    </kanban-list>
  </ng-template>

</ng-dnd-sortable-list>
